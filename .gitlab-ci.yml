gcc-release:
  tags:
    - bionic
  script:
    - export CXX=g++-7
    - export CC=gcc-7
    - mkdir -p build-gcc-7-release
    - cd build-gcc-7-release
    - cmake -GNinja -DCMAKE_BUILD_TYPE=Release ..
    - ninja lmdb-test
    - ./lmdb-test

clang-debug-asan:
  tags:
    - bionic
  script:
    - export CXX=clang++-6.0
    - export CC=clang-6.0
    - export CXXFLAGS="-fsanitize=address -fno-omit-frame-pointer"
    - mkdir -p build-clang-5-debug-asan
    - cd build-clang-5-debug-asan
    - cmake -GNinja -DCMAKE_BUILD_TYPE=Debug ..
    - ninja lmdb-test
    - ./lmdb-test

gcc-valgrind:
  tags:
    - bionic
  script:
    - export CXX=g++-7
    - export CC=gcc-7
    - mkdir -p gcc-7-valgrind
    - cd gcc-7-valgrind
    - cmake -GNinja -DCMAKE_BUILD_TYPE=Debug ..
    - ninja lmdb-test
    - valgrind --leak-check=full --show-reachable=yes --gen-suppressions=all --suppressions=../valgrind.supp ./lmdb-test

msvc-release:
  tags:
    - windows
  script:
    - set WD=%cd%
    - call "C:\Program Files (x86)\Microsoft Visual Studio\2019\BuildTools\VC\Auxiliary\Build\vcvars64.bat"
    - cd %WD%
    - mkdir build-msvc-release
    - cd build-msvc-release
    - cmake -GNinja -DCMAKE_BUILD_TYPE=Release ..
    - ninja lmdb-test
    - lmdb-test

msvc-debug:
  tags:
    - windows
  script:
    - set WD=%cd%
    - call "C:\Program Files (x86)\Microsoft Visual Studio\2019\BuildTools\VC\Auxiliary\Build\vcvars64.bat"
    - cd %WD%
    - mkdir build-msvc-debug
    - cd build-msvc-debug
    - cmake -GNinja -DCMAKE_BUILD_TYPE=Debug ..
    - ninja lmdb-test
    - lmdb-test

clang-format:
  tags:
    - bionic
  script:
    - mkdir build-clang-format
    - cd build-clang-format
    - cmake -GNinja ..
    - ninja lmdb-format-check

clang-tidy:
  tags:
    - bionic
  script:
    - export CXX=clang++-6.0
    - export CC=clang-6.0
    - mkdir build-clang-tidy
    - cd build-clang-tidy
    - cmake -GNinja -DLMDB_LINT=On ..
    - ninja lmdb-test